#!/bin/bash

# Descriptor CLI Wrapper
# This script activates the virtual environment and runs the main descriptor script

SOURCE="${BASH_SOURCE[0]}"
while [ -h "$SOURCE" ]; do
  DIR="$( cd -P "$( dirname "$SOURCE" )" >/dev/null 2>&1 && pwd )"
  SOURCE="$(readlink "$SOURCE")"
  [[ $SOURCE != /* ]] && SOURCE="$DIR/$SOURCE"
done
SCRIPT_DIR="$( cd -P "$( dirname "$SOURCE" )" >/dev/null 2>&1 && pwd )"
PROJECT_DIR="$(cd "$SCRIPT_DIR/.." && pwd)"
VENV_DIR="$SCRIPT_DIR/venv"
MAIN_SCRIPT="$PROJECT_DIR/descriptor.py"

# Check if virtual environment exists
if [[ ! -d "$VENV_DIR" ]]; then
    echo "Error: Virtual environment not found. Please run install.sh first."
    exit 1
fi

# Check if main script exists
if [[ ! -f "$MAIN_SCRIPT" ]]; then
    echo "Error: Main descriptor script not found at $MAIN_SCRIPT"
    exit 1
fi

# Activate virtual environment
source "$VENV_DIR/bin/activate"

# Run the main descriptor script with all arguments
python3 "$MAIN_SCRIPT" "$@"

# Exit with the same code as the descriptor script
exit $?
